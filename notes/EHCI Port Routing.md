# EHCI Port Routing
- typeracer
	- a USB 2.0 Host controller (as described in Section 1.1) is comprised of one high-speed host controller, which implements the EHCI programming interface and 0 to N USB 1.1 companion host controllers. Companion host controllers (cHCs) may be implementations of either Universal or Open host controller specification. This configuration is used to deliver the required full USB 2.0-defined port capability; e.g. Low-, Full-, and High-speed capability for every port. Figure 4-1 illustrates a simple block diagram of the port routing logic and its relationship to the high-speed and companion host controllers within a USB 2.0 host controller. 
	- There exists one transceiver per physical port and each host controller module has its own port status and control registers. The EHCI controller has port status and control registers for ever port. Each companion host controller has only the __port control__ and __status registers__ it is required to operate. Each transceiver can be controller by either the EHCI host controller or one companion host controller. Routing logic lies between the transceiver and the port status and control registers. The port routing logic is controller from signals originating in the EHCI host controller. The EHCI host controller has a global routing policy control field and per-port ownership control fields. The Configured Flag bit is the global routing policy control. At power-on or reset, the default routing policy is to the companion controllers . If the system does not include a driver for the EHCI host controller and the host controller includes Companion Controllers, then the ports will still work in Full- and Low-speed mode (assuming the system includes a driver for the companion controllers). In general, when the EHCI owns the ports, the companion host controllers' port registers do not see a connect indication from the transceiver. Similarly, when a companion host controller owns a port, the EHCi controller's port registers do not see a connect indication from the transceiver. Similarly, when a companion host controller owns a poart, the EHCI controller's port registers do not see a connect indication from the transceiver. The details on the rules for the port routing logic are described in the following sections.
	- The USB 2.0 host controller must be implemented as a multi-function PCI device if the implementation includes companion controllers. The companion host controllers' function numbers must be less than the EHCI host controller function number. The EHCI host controller must be a larger function number with respect to the companion host controllers associated with this EHCI host controller. If a PCi device implementation contains only an EHCI controller then the EHCI host controlelr must be function zero, in accordance iwth the PCi Specification.
	- The N_CC field in the Structural Parameter register (HCSPARAMS) indicates whether the controller implementation includes companion host controllers. When N_CC has a non-zero value there exists companion host controllers. If n_CC has a value of zero, then the host controller implmentation does not include cocmpanion host controllers. If the host controller root ports are exposed to attachement of full- or low-speed devices, the port will always fail the high-speed chirp during reset and the ports will not be enabled. System software can notify the user of the illegal condition. This type of implementation requires a USB 2.0 hub be onnected to a rootport to provide full and low-speed device connectivity. System software uses information in the host controller capaability registers to determine how the ports are routed to the compa
	- Each port in the USB 2.0 host controller can be routed either to a single companion host controller or the the EHCI host controller. The port routing logic is controlled by two mechanisms in the EHCI HC; a host controller global flag and per-port control. The Configured Flag bit defined in Section 2.3.8, is used to globally set the policy of



### Maybe useful snippets?
- The Configured Flag (CF) bit (Section 2.3.8), is used to globally set the policy of the routign logic. Each port register has a Port Owner contol bit which allows the EHCI Driver to explicitly control the routing of individaul ports. Whenever the CF bit transistions from a zero to a one (this transition is only available under program control) the port routing unconditionally routes all of the port registers to the EHCI HC (All port Owner bits go to zero). While the CF-bit is one, the EHCI Driver can control individual ports' routign via the Port Owner control bit. Likewise, whenever the CF bit transitions from a one to a zero (as aresult of Aux power application, HCRESET, or software writing a zero to CF-bit), the port routing unconditionally routes all the theport registers to the appropriate copanion HC. The default value for hte EHCI HC's CF bit (after Aux power application or HCRESET) is zero. Table 4-2 summarizes the default routing for all the ports, based onthe value of the EHCI HC's CF bit.

### Summary
- Configured Flag (CF) 